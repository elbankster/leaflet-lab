
<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Leaflet</title>
	
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			max-width: 100%;
			max-height: 100%;
		}
	</style>
</head>
<body>

<div id="map" style="width:100%; height: 90vh;"></div>

<script>

    var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    });

    // layer groups
    var public_launches = L.layerGroup();
    var user_locations = L.layerGroup();

    const map = L.map('map', {
    center: [43, -81],
    zoom: 11,
    layers: [osm, public_launches, user_locations]
    });

    // Define a custom icon with adjusted shadow settings
    var customIcon = L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
        iconSize: [25, 41], // size of the icon
        shadowSize: [41, 41], // size of the shadow
        iconAnchor: [12, 41], // point of the icon which will correspond to marker's location
        shadowAnchor: [12, 41], // point of the shadow which will correspond to marker's location
        popupAnchor: [1, -34] // point from which the popup should open relative to the iconAnchor
    });

    // query public launches and place the markers
    async function addPublicLaunches() {

        // get window bounds, used to build overpass query string
        const bounds = map.getBounds();

        // build query string
        const query = `
            [out:json];
            node["leisure"="slipway"](${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()});out;
        `;
        
        var url = 'https://overpass-api.de/api/interpreter?data=' + encodeURIComponent(query);
        
        // get data from url
        fetch(url)
        .then(response => response.json())
        .then(data => {

            // Process the data returned
            data.elements.forEach(element => {
                if (element.type === 'node') {
                    
                    // add marker to the map
                    var marker = L.marker([element.lat, element.lon],{ icon: customIcon });

                    // if this node has a name identified, add it as a popup
                    if(element.tags.name) {
                        marker.bindPopup(element.tags.name);
                    }

                    public_launches.addLayer(marker);
                }
            });
        
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    
    }

    function addUserLocation(e) {
        var name = prompt("Name this location:");

        if(name) var waterway = prompt("Waterway:");
        
        if(name && waterway) {
            var marker = L.marker(e.latlng).addTo(user_locations)
            .bindPopup(name + '\n' + waterway)
            .openPopup(); 
        }
        
    }

    addPublicLaunches();

    map.on('moveend',addPublicLaunches);
    map.on('click', addUserLocation);

    // Add the layer group to the map's layer control
    var baseLayers = {
        "OpenStreetMap": osm
    };

    var overlayLayers = {
        "Public Launches": public_launches,
        "User Locations": user_locations
    };

    L.control.layers(baseLayers, overlayLayers).addTo(map);

</script>



</body>
</html>
